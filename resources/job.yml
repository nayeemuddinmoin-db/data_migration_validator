new_cluster: &new_cluster
  new_cluster:
    spark_version: 16.4.x-scala2.12
    node_type_id: Standard_E16ads_v5
    driver_node_type_id: Standard_E16ads_v5
    enable_elastic_disk: true
    data_security_mode: USER_ISOLATION
    runtime_engine: STANDARD
    autoscale:
      min_workers: 1
      max_workers: 4
    azure_attributes:
      first_on_demand: 1
      availability: ON_DEMAND_AZURE
      spot_bid_max_price: -1
    custom_tags:
      LOB: Connectivity
      BusinessContact: xyz@ril.com
      ProjectName: DBX

variables:
  run_dbx_jobs_as_user:
    description: job run as user
    default: rahul.singha@databricks.com

resources:
  jobs:
    wf_dmv_validator_runner:
      name: wf_dmv_validator_runner_nayeem
      job_clusters:
        - job_cluster_key: data_mig_validator_job_cluster
          <<: *new_cluster
      run_as: 
        user_name: ${var.run_dbx_jobs_as_user}
      # notification_settings:
      #   no_alert_for_skipped_runs: true
      #   no_alert_for_canceled_runs: true
      # schedule:
      #   quartz_cron_expression: 11 22 1/2 * * ?
      #   timezone_id: UTC
      #   pause_status: UNPAUSED
      max_concurrent_runs: 10
      tasks:
        - task_key: tsk-dmv-validator-run
          notebook_task:
            notebook_path: ../src/validation/migration-data-validation/migration-data-validation.py
            base_parameters:
              00-triggered_from_workflow: ""
              01-iteration_name_suffix: ""
              03-workflow:table_family: ""
              05-user_email: ""
              04-user_name: ""
              02-workflow_name: ""
            source: WORKSPACE
          # existing_cluster_id: 0829-052756-oyofxpy7
          job_cluster_key: data_mig_validator_job_cluster
      queue:
        enabled: true
